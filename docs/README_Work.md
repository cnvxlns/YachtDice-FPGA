# 🎲 Yacht Dice Game - FPGA Implementation Work Log

이 문서는 Yacht Dice 게임 프로젝트를 구성하는 각 Verilog 모듈의 역할과 전체 시스템의 동작 흐름을 정리한 문서입니다.

## 1. 모듈별 역할 (Module Descriptions)

### `YachtDice_Top.v` (Top Module)
*   **역할**: 전체 시스템의 최상위 모듈입니다.
*   **기능**:
    *   FPGA의 물리적 핀(Clock, Reset, Button, Switch, LED, 7-Segment)과 내부 하위 모듈들을 연결합니다.
    *   각 모듈 간의 신호(Wire)를 중계하여 데이터 흐름을 형성합니다.
    *   **주사위 초기화 연결**: FSM에서 생성된 `turn_start` 신호를 Dice Manager의 `clear_dice` 포트에 연결하여, 턴 시작 시 주사위 값을 0으로 초기화합니다.
    *   **LED 제어**: 
        *   LED1~5: 주사위 Hold 상태
        *   LED6: 점수 선택 모드 (Select Phase) 표시
        *   LED7/8: 현재 플레이어 턴 (P1/P2)

### `Button_Debouncer.v`
*   **역할**: 기계적 버튼 입력의 노이즈(Chattering)를 제거합니다.
*   **기능**:
    *   입력 신호가 일정 시간(약 20ms) 동안 안정적으로 유지될 때만 유효한 신호로 출력합니다.
    *   클럭 도메인 교차(CDC) 문제를 방지하기 위한 동기화 로직을 포함하여 시스템 안정성을 높입니다.

### `Game_FSM.v` (Finite State Machine)
*   **역할**: 게임의 전체 진행 흐름과 규칙을 제어하는 핵심 제어 장치(Brain)입니다.
*   **기능**:
    *   **상태 관리**: 대기, 주사위 굴리기, 점수 선택, 점수 계산, 턴 넘기기, 게임 종료 등의 상태 전이를 제어합니다.
    *   **데이터 관리**: 현재 플레이어 턴(P1/P2), 현재 라운드(1~12), 각 플레이어의 총점을 관리합니다.
    *   **상단 보너스**: 상단 항목(Aces~Sixes)의 점수 합계가 63점 이상이 되는 즉시 보너스 점수(+35점)를 부여합니다.
    *   **안전 장치**: `dice_ready` 신호를 통해 주사위 값이 유효할 때만(0이 아닐 때만) 점수 선택 단계로 진입하도록 제어합니다.
    *   **턴 시작 신호**: 턴이 시작될 때 `turn_start` 펄스를 생성하여 주사위 값을 초기화하도록 지시합니다.
    *   **입력 처리**: 디바운싱된 버튼 입력을 받아 게임 로직을 수행합니다.

### `Dice_Manager.v`
*   **역할**: 5개의 주사위 값을 생성하고 유지/변경을 관리합니다.
*   **기능**:
    *   **난수 생성**: 32비트 LFSR(Linear Feedback Shift Register) 알고리즘을 사용하여 1~6 사이의 의사 난수를 생성합니다.
    *   **Hold 기능**: 사용자가 DIP 스위치(`SW`)로 선택한 주사위는 값을 유지하고, 선택하지 않은 주사위만 새로 굴립니다.
    *   **초기화 기능**: `clear_dice` 신호가 입력되면 모든 주사위 값을 0으로 초기화하여, 새로운 턴이 시작됨을 명확히 합니다.

### `Score_Calculator.v`
*   **역할**: 현재 주사위 조합에 따른 점수를 계산합니다.
*   **기능**:
    *   **조합 논리**: 입력된 5개의 주사위 값과 사용자가 선택한 카테고리(Ones, Full House, Yacht 등)를 분석합니다.
    *   **안전성 확보**: 주사위 값이 유효 범위(1~6) 내에 있을 때만 카운트를 수행하도록 하여, 배열 인덱스 초과 오류를 방지합니다.
    *   **점수 산출**: 해당 카테고리의 규칙에 따라 획득 가능한 점수를 계산하여 FSM에 전달합니다.
        *   **Upper Section (1. , ... 6.)**: 해당 숫자의 합 (Aces ~ Sixes)
        *   **Choice (CH)**: 주사위 5개의 총 합
        *   **4 of a Kind (4n)**: 해당 숫자 4개의 합
        *   **Full House (FH)**: 주사위 5개의 총 합
        *   **Small Straight (SS)**: 15점
        *   **Large Straight (LS)**: 30점
        *   **Yacht (YA)**: 50점

### `Display_Controller.v`
*   **역할**: 7-Segment Display에 게임 정보를 시각적으로 표시합니다.
*   **기능**:
    *   **Multiplexing**: 사람의 눈에 동시에 켜진 것처럼 보이도록 고속으로 자릿수를 스위칭(Time Multiplexing)합니다.
    *   **정보 표시**: 주사위 5개의 값(Digit 0~4)과 선택 중인 카테고리(Digit 6~7)를 표시합니다.
    *   **카테고리 약어 표시**: 족보를 직관적으로 알아볼 수 있도록 약어로 표시합니다. (예: `FH`(Full House), `YA`(Yacht), `1.`(Aces) 등)

### `LCD_Controller.v`
*   **역할**: 16x2 Text LCD를 제어하여 게임 상태와 점수를 표시합니다.
*   **기능**:
    *   **상태 표시**: 게임 시작 시 "GAME START", 종료 시 "GAME END" 및 **승자(P1 WIN/P2 WIN/DRAW)**를 표시하며, 진행 중에는 **현재 라운드(예: "ROUND 1")**를 표시합니다.
    *   **점수 표시**: Player 1과 Player 2의 현재 점수를 실시간으로 업데이트하여 보여줍니다. (예: "P1:120  P2:095")
    *   **초기화 및 제어**: LCD 모듈의 초기화 시퀀스를 수행하고, 문자 데이터를 전송합니다.

---

## 2. 전체 동작 순서 (System Operation Flow)

시스템은 전원이 켜지면 다음과 같은 순서로 유기적으로 동작합니다.

### 1. 초기화 (Initialization)
*   **Reset**: `RST_BTN`이 눌리면 모든 레지스터와 상태가 초기화됩니다.
*   **Start**: `Game_FSM`은 초기 상태(`S_INIT`)에서 시작하여 Player 1의 턴(`S_P1_START`)으로 진입합니다.

### 2. 턴 진행: 주사위 굴리기 (Roll Phase)
1.  **턴 시작**: 해당 턴의 플레이어는 `BTN0 (Roll)`을 눌러 주사위를 굴립니다.
2.  **난수 생성**: `Game_FSM`이 `roll_trigger` 신호를 보내면, `Dice_Manager`가 동작하여 주사위 값을 변경합니다.
3.  **Hold 전략**: 플레이어는 `SW0~4`를 조작하여 원하는 주사위를 고정(Hold)합니다. 고정된 주사위는 다음 굴리기에서 값이 변하지 않습니다.
4.  **기회 제한**: 한 턴당 최대 3번까지 주사위를 굴릴 수 있습니다. (3번을 다 쓰거나, 도중에 멈추고 점수를 선택할 수 있습니다.)

### 3. 턴 진행: 점수 선택 (Select Phase)
1.  **모드 진입**: `BTN1 (Select)`을 누르면 점수 선택 모드로 진입합니다.
2.  **카테고리 탐색**: `BTN4 (Prev)`와 `BTN5 (Next)`를 눌러 점수 카테고리(Ones, Twos ... Yacht)를 변경합니다.
3.  **점수 확정**: 원하는 카테고리에서 `BTN1 (Select)`을 다시 누르면 점수가 확정되고 플레이어의 총점에 합산됩니다.

### 4. 턴 교체 및 라운드 관리 (Turn Change)
*   **턴 넘기기**: 점수가 확정되면 `Game_FSM`은 턴을 상대방(P1 → P2 또는 P2 → P1)에게 넘깁니다.
*   **라운드 증가**: 두 플레이어가 모두 턴을 마치면 라운드 수가 1 증가합니다.

### 5. 게임 종료 (Game Over)
*   **종료 조건**: 총 12라운드가 모두 종료되면 `S_GAME_END` 상태가 됩니다.
*   **결과 확인**: 최종 점수와 함께 **승자(P1 WIN, P2 WIN, DRAW)**가 LCD에 표시됩니다. 더 이상 게임이 진행되지 않으며, 리셋 버튼을 눌러 재시작할 수 있습니다.
